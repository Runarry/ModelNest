# ModelNest 用户数据清理机制

## 概述

ModelNest 应用在卸载过程中会清理用户数据目录中的缓存和日志文件，以保持系统整洁。这个文档描述了清理机制的实现方式。

## 清理策略

应用在卸载时会清理以下目录：

1. **缓存目录** - `%APPDATA%\model-nest\cache`
   - 包含图片缓存文件
   - 包含模型信息缓存数据库

2. **日志目录** - `%APPDATA%\model-nest\logs`
   - 包含应用运行时生成的日志文件

## 实现方式

清理机制通过以下方式实现：

### 1. NSIS 卸载脚本

在 `scripts/installer.nsh` 文件中，我们定义了自定义卸载宏 `customUnInstall`，该宏会：

- 创建一个标记文件 `.uninstall_cleanup_required`，表示卸载正在进行
- 直接尝试删除缓存和日志目录
- 不删除整个 model-nest 目录，以保留用户设置

### 2. 应用退出时的清理

在 `main.js` 中，我们监听 `will-quit` 事件，当应用退出时：

- 检查是否存在卸载标记文件
- 如果存在，执行清理操作
- 删除标记文件
- 继续退出应用

### 3. 用户界面中的清理选项

在缓存统计调试面板中（按下 `Ctrl+Shift+C` 键访问），提供了手动清理按钮：

- **清理缓存目录** - 清除缓存目录
- **清理日志目录** - 清除日志目录

## 清理功能 API

清理功能通过以下 API 实现：

- `window.api.cleanupUserData(options)` - 主要清理函数
  - `options.cleanCache` - 是否清理缓存目录
  - `options.cleanLogs` - 是否清理日志目录

## 注意事项

1. 清理操作不会删除用户配置文件 `config.json`
2. 清理后，应用下次启动时会自动重建必要的目录结构
3. 如果应用在卸载过程中未正常退出，可能导致清理不完全 